syntax = "proto3";

package m3em;

service Operator {
  rpc Setup(SetupRequest)              returns (SetupResponse);
	rpc Transfer(stream TransferRequest) returns (TransferResponse);
	rpc Start(StartRequest)              returns (StartResponse);
	rpc Stop(StopRequest)                returns (StopResponse);
	rpc Teardown(TeardownRequest)        returns (TeardownResponse);
}

enum FileType {
  UNKNOWN        = 0;
  SERVICE_BINARY = 1;
  SERVICE_CONFIG = 2;
  // log file
}

message SetupRequest {
  string session_token            = 1;
  string operator_uuid            = 2;
  bool   force                    = 3;
  bool   heartbeat_enabled        = 4;
  string heartbeat_endpoint       = 5;
  uint32 heartbeat_frequency_secs = 6;
}

message SetupResponse {
}

message TransferRequest {
  FileType type          = 1;
  string   filename      = 2;
  bool     overwrite     = 3;
  int32    chunk_idx     = 4;
  bytes    chunk_bytes   = 5;
}

message TransferResponse {
  uint32 file_checksum    = 1;
  int32  num_chunks_recvd = 2;
}

message StartRequest {
}

message StartResponse {
}

message StopRequest {
}

message StopResponse {
}

message TeardownRequest {
}

message TeardownResponse {
}
