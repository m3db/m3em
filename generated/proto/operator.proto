syntax = "proto3";

package m3em;

service Operator {
  rpc Setup(SetupRequest)              returns (SetupResponse);
	rpc Transfer(stream TransferRequest) returns (TransferResponse);
	rpc Start(StartRequest)              returns (StartResponse);
	rpc Stop(StopRequest)                returns (StopResponse);
	rpc Teardown(TeardownRequest)        returns (TeardownResponse);
  rpc Heartbeat(HeartbeatRequest)      returns (stream HeartbeatResponse);
}

enum FileType {
  UNKNOWN     = 0;
  M3DB_BINARY = 1;
  M3DB_CONFIG = 2;
  // log file
}

message SetupRequest {
  string token = 1;
  bool   force = 2;
}

message SetupResponse {
}

message TransferRequest {
  FileType type          = 1;
  string   filename      = 2;
  bool     overwrite     = 3;
  int32    chunk_idx     = 4;
  bytes    chunk_bytes   = 5;
}

message TransferResponse {
  uint32 file_checksum    = 1;
  int32  num_chunks_recvd = 2;
}

message StartRequest {
}

message StartResponse {
}

message StopRequest {
}

message StopResponse {
}

message TeardownRequest {
}

message TeardownResponse {
}

message HeartbeatRequest {
  uint32 frequency_secs = 1;
}

enum HeartbeatCode {
  HEARTBEAT_CODE_UNKNOWN             = 0;
  HEARTBEAT_CODE_HEALTHY             = 1;
  HEARTBEAT_CODE_PROCESS_TERMINATION = 2;
  HEARTBEAT_CODE_OVERWRITTEN         = 3;
}

message HeartbeatResponse {
  HeartbeatCode code           = 1;
  string        error          = 2;
  bool          processRunning = 3;
}